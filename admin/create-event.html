<!DOCTYPE html>
<html>
<head>
  <title>Create Event | SevaSphere</title>
<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:"Segoe UI", sans-serif;
}

body{
  background:linear-gradient(135deg,#168AAD,#52B69A);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
}

.form-wrapper{
  width:100%;
  max-width:600px;
}

h2{
  text-align:center;
  color:white;
  margin-bottom:25px;
  font-weight:600;
}

.form-container{
  background:white;
  padding:30px;
  border-radius:18px;
  box-shadow:0 15px 40px rgba(0,0,0,0.2);
}

input, textarea{
  width:100%;
  padding:12px 14px;
  margin-bottom:15px;
  border:1px solid #e0e0e0;
  border-radius:10px;
  font-size:14px;
  transition:0.2s;
}

input:focus, textarea:focus{
  border-color:#168AAD;
  outline:none;
  box-shadow:0 0 0 2px rgba(22,138,173,0.15);
}

textarea{
  resize:vertical;
  min-height:90px;
}

button{
  width:100%;
  padding:13px;
  border:none;
  border-radius:12px;
  font-weight:600;
  background:#168AAD;
  color:white;
  cursor:pointer;
  transition:0.2s;
}

button:hover{
  background:#126782;
}
</style>
</head>
<body>

  <h2>NGO - Create Event</h2>

  <div class="form-container">
    <input id="title" placeholder="Event Title" required>
    <input id="category" placeholder="Category (Tree Plantation, Teaching...)" required>
    <input id="location" placeholder="Location" required>
    <input id="date" type="date" required>
    <input id="time" placeholder="Time (08:00 AM)" required>
    <input id="ngo" placeholder="NGO Name" required>
    <textarea id="description" placeholder="Event Description" required></textarea>
    <button id="createBtn">Create Event</button>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-z1Zx-0qAj6_FGiclcXFdIjiKSjXlUKw",
  authDomain: "sevasphere-6dce7.firebaseapp.com",
  databaseURL: "https://sevasphere-6dce7-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "sevasphere-6dce7",
  storageBucket: "sevasphere-6dce7.appspot.com",
  messagingSenderId: "930986469572",
  appId: "1:930986469572:web:7c62c3e6ff7c3f90d98191"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUser = null;

// ðŸ”¥ Ensure admin is logged in
onAuthStateChanged(auth, (user) => {
  if (!user) {
    alert("Please login as admin first.");
    window.location.href = "admin-login.html";
    return;
  }
  currentUser = user;
});

document.getElementById("createBtn").addEventListener("click", async () => {

  if (!currentUser) {
    alert("User not authenticated!");
    return;
  }

  const title = document.getElementById("title").value.trim();
  const category = document.getElementById("category").value.trim();
  const location = document.getElementById("location").value.trim();
  const date = document.getElementById("date").value;
  const time = document.getElementById("time").value.trim();
  const ngo = document.getElementById("ngo").value.trim();
  const description = document.getElementById("description").value.trim();

  if (!title || !category || !location || !date || !time || !ngo || !description) {
    alert("Please fill all fields!");
    return;
  }

  try {

    const eventsRef = ref(db, "events");
    const newEventRef = push(eventsRef);

    await set(newEventRef, {
      title,
      category,
      location,
      date,
      time,
      ngo,
      description,
      createdAt: Date.now(),
      createdBy: currentUser.uid   // ðŸ”¥ THIS FIXES EVERYTHING
    });

    alert("Event Created Successfully ðŸŽ‰");
    window.location.href = "admin-dashboard.html";

  } catch (error) {
    console.error(error);
    alert("Error creating event!");
  }

});
</script>
</body>
</html>
